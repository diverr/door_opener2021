{"version":3,"sources":["assets/img/remote.png","Global.js","Button.js","Form.js","App.js","reportWebVitals.js","index.js"],"names":["Global","serviceUrl","process","Button","useState","opacity","setOpacity","opening","setOpening","key","localStorage","getItem","user","url","useGeolocated","positionOptions","enableHighAccuracy","userDecisionTimeout","coords","isGeolocationEnabled","getDistanceFromLatLonInKm","lat1","lon1","lat2","lon2","deg2rad","deg","Math","PI","dLat","dLon","a","sin","cos","atan2","sqrt","open","console","log","Number","latitude","longitude","toast","error","autoClose","info","axios","get","welcome","success","bind","useDoubleTap","src","remote","className","alt","style","Form","setKey","useLocation","setLocation","users","type","id","placeholder","onChange","e","target","value","onClick","userId","split","setItem","App","version","useEffect","then","catch","component","path","to","newestOnTop","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.307f4a8b.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/remote.7c35736d.png\";","const Global = {\n  serviceUrl: process.env.REACT_APP_SERVICE_URL,\n};\n\nexport default Global;\n","import React, { useState } from 'react';\nimport remote from './assets/img/remote.png';\nimport './Button.css';\nimport Global from './Global';\nimport { toast } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.css';\nimport { useDoubleTap } from 'use-double-tap';\nimport axios from 'axios';\nimport { useGeolocated } from 'react-geolocated';\n\nexport default function Button() {\n  const [opacity, setOpacity] = useState(1);\n  const [opening, setOpening] = useState(false);\n\n  const key = localStorage.getItem('key') ?? null;\n  const user = localStorage.getItem('user') ?? null;\n\n  const url = `${Global.serviceUrl}/${key}`;\n  // WARNING! change before sending to production\n  // const url = `${Global.serviceUrl}`;\n\n  const { coords, isGeolocationEnabled } = useGeolocated({\n    positionOptions: {\n      enableHighAccuracy: false,\n    },\n    userDecisionTimeout: 10000,\n  });\n\n  const getDistanceFromLatLonInKm = (lat1, lon1, lat2, lon2) => {\n    const deg2rad = (deg) => {\n      return deg * (Math.PI / 180);\n    };\n    const R = 6371; // Radius of the earth in km\n    const dLat = deg2rad(lat2 - lat1); // deg2rad below\n    const dLon = deg2rad(lon2 - lon1);\n    const a =\n      Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n      Math.cos(deg2rad(lat1)) *\n        Math.cos(deg2rad(lat2)) *\n        Math.sin(dLon / 2) *\n        Math.sin(dLon / 2);\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    const d = R * c; // Distance in km\n    return d;\n  };\n\n  const home_lng = process.env.REACT_APP_HOME_LNG;\n  const home_lat = process.env.REACT_APP_HOME_LAT;\n\n  const open = async () => {\n    if (opening) return;\n    setOpening(true);\n\n    console.log({ coords });\n    if (isGeolocationEnabled) {\n      const distance = getDistanceFromLatLonInKm(\n        Number(home_lat),\n        Number(home_lng),\n        coords.latitude,\n        coords.longitude\n      );\n\n      // TODO: check user type\n      if (distance > 0.5) {\n        toast.error('Lo siento, no estás en casa', {\n          autoClose: 2000,\n        });\n        setOpening(false);\n        return;\n      }\n    }\n\n    setOpacity(0.2);\n\n    toast.info('Abriendo puerta... ', {\n      autoClose: 2000,\n    });\n\n    try {\n      await axios.get(url);\n\n      const welcome = user === 'Papá' ? 'bienvenido' : 'bienvenida';\n\n      toast.success(`Puerta abierta, ${welcome} a casa ${user}`, {\n        autoClose: 2000,\n      });\n    } catch (e) {\n      toast.error(`Error abriendo la puerta: ${e}`, { autoClose: 2000 });\n    } finally {\n      setOpacity(1);\n      setOpening(false);\n    }\n  };\n\n  const bind = useDoubleTap(open);\n\n  return (\n    <div>\n      <img\n        src={remote}\n        className=\"button\"\n        alt=\"Abrir\"\n        style={{ opacity: opacity }}\n        {...bind}\n      />\n    </div>\n  );\n}\n","import React, { useState } from 'react';\nimport { useLocation } from 'wouter';\nimport './Form.css';\n\nexport default function Form() {\n  const [key, setKey] = useState('');\n  const [location, setLocation] = useLocation();\n\n  const users = {\n    '001': 'Papá',\n    '002': 'Mamá',\n    '003': 'Guadalupe',\n  };\n\n  const send = () => {\n    if (!key || key === '') return;\n\n    const userId = key.split('#')[1];\n\n    localStorage.setItem('key', key);\n    localStorage.setItem('user', users[userId]);\n\n    setLocation('/button');\n  };\n\n  return (\n    <div className=\"form\">\n      <input\n        type=\"text\"\n        id=\"key\"\n        placeholder=\"Introduce llave\"\n        onChange={(e) => setKey(e.target.value)}\n      />\n      <br />\n      <button id=\"btn-send\" onClick={send}>\n        Enviar\n      </button>\n    </div>\n  );\n}\n","import React, { useEffect } from 'react';\nimport './App.css';\nimport Button from './Button';\nimport { Link, Route, useLocation } from 'wouter';\nimport Form from './Form';\nimport { toast, ToastContainer } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.css';\nimport Global from './Global';\nimport axios from 'axios';\n\nfunction App() {\n  const version = process.env.REACT_APP_VERSION;\n  console.log('version', version);\n\n  const key = localStorage.getItem('key') ?? null;\n\n  const [location, setLocation] = useLocation();\n\n  useEffect(() => {\n    axios\n      .get(Global.serviceUrl)\n      .then(() => {\n        toast.success('Servicio preparado', {\n          autoClose: 2000,\n        });\n      })\n      .catch((e) => {\n        toast.error(`Error de comunicación: ${e}`, {\n          autoClose: 2000,\n        });\n      });\n  }, []);\n\n  if (key) {\n    setLocation('/button');\n  }\n\n  return (\n    <div className=\"App\">\n      <Route component={Form} path=\"/\" />\n      <Route component={Button} path=\"/button\" />\n      <br />\n      <br />\n      <div className=\"version\">\n        <Link to=\"/\">{version}</Link>\n      </div>\n      <ToastContainer newestOnTop />\n    </div>\n  );\n}\n\nexport default App;\n","const reportWebVitals = (onPerfEntry) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import(\"web-vitals\").then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport App from './App'\nimport reportWebVitals from './reportWebVitals'\n\nReactDOM.render(\n    <React.StrictMode>\n        <App />\n    </React.StrictMode>,\n    document.getElementById('root')\n)\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals()\n"],"sourceRoot":""}